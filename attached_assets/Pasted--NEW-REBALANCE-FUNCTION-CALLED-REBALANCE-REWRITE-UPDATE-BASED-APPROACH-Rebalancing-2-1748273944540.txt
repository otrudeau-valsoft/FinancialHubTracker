ðŸš€ NEW REBALANCE FUNCTION CALLED! ðŸš€
=== REBALANCE REWRITE - UPDATE-BASED APPROACH ===
Rebalancing 20 stocks for USD region
Existing symbols: MA, COST, PEP, CAT, PWR, CW, PANW, AVGO, UBER, MCO, BIL, GLD, MSFT, AAPL, GOOG, META, AMZN, WM, GS, JPM
New symbols: MA, COST, PEP, CAT, PWR, CW, PANW, AVGO, UBER, MCO, BIL, GLD, MSFT, AAPL, GOOG, META, AMZN, WM, GS, JPM
Processing MA:
  - Company: MASTERCARD INC CLASS A
  - Stock Type: Comp
  - Rating: 1
  - Sector: Financial Services
  - Quantity: 20
  - Purchase Price: 88.7
  -> UPDATING existing stock
Processing COST:
  - Company: COSTCO WHOLESALE CORP
  - Stock Type: Comp
  - Rating: 1
  - Sector: Consumer Defensive
  - Quantity: 4
  - Purchase Price: 543.3
  -> UPDATING existing stock
Processing PEP:
  - Company: PEPSICO INC
  - Stock Type: cat
  - Rating: 3
  - Sector: Consumer Defensive
  - Quantity: 18
  - Purchase Price: 154.53
  -> UPDATING existing stock
Processing CAT:
  - Company: CATERPILLAR INC
  - Stock Type: Cycl
  - Rating: 2
  - Sector: Industrials
  - Quantity: 12
  - Purchase Price: 348.46
  -> UPDATING existing stock
Processing PWR:
  - Company: QUANTA SERVICES INC
  - Stock Type: CAT
  - Rating: 2
  - Sector: Industrials
  - Quantity: 14
  - Purchase Price: 271.35
  -> UPDATING existing stock
Processing CW:
  - Company: CURTISS WRIGHT
  - Stock Type: Cat
  - Rating: 2
  - Sector: Industrials
  - Quantity: 10
  - Purchase Price: 355.03
  -> UPDATING existing stock
Processing PANW:
  - Company: PALO ALTO NETWORKS INC
  - Stock Type: Comp
  - Rating: 2
  - Sector: Technology
  - Quantity: 24
  - Purchase Price: 149.18
  -> UPDATING existing stock
Processing AVGO:
  - Company: BROADCOM INC
  - Stock Type: Cycl
  - Rating: 2
  - Sector: Technology
  - Quantity: 22
  - Purchase Price: 146.49
  -> UPDATING existing stock
Processing UBER:
  - Company: UBER TECHNOLOGIES INC
  - Stock Type: Cat
  - Rating: 2
  - Sector: Technology
  - Quantity: 50
  - Purchase Price: 36.58
  -> UPDATING existing stock
Processing MCO:
  - Company: MOODYS CORP
  - Stock Type: Comp
  - Rating: 2
  - Sector: Financial Services
  - Quantity: 10
  - Purchase Price: 238.21
  -> UPDATING existing stock
Processing BIL:
  - Company: SPDR BLOOMBERG 1-3 MONTH T-BILL ETF
  - Stock Type: Comp
  - Rating: 3
  - Sector: Financial Services
  - Quantity: 20
  - Purchase Price: 91.67
  -> UPDATING existing stock
Processing GLD:
  - Company: SPDR GOLD ETF
  - Stock Type: Comp
  - Rating: 3
  - Sector: Commodities
  - Quantity: 12
  - Purchase Price: 147.49
  -> UPDATING existing stock
Processing MSFT:
  - Company: Microsoft
  - Stock Type: Comp
  - Rating: 1
  - Sector: Technology
  - Quantity: 16
  - Purchase Price: 320
  -> UPDATING existing stock
Processing AAPL:
  - Company: APPLE INC
  - Stock Type: Comp
  - Rating: 1
  - Sector: Technology
  - Quantity: 40
  - Purchase Price: 24.8
  -> UPDATING existing stock
Processing GOOG:
  - Company: ALPHABET INC CLASS C
  - Stock Type: Comp
  - Rating: 1
  - Sector: Technology
  - Quantity: 32
  - Purchase Price: 29.06
  -> UPDATING existing stock
Processing META:
  - Company: META PLATFORMS INC CLASS A
  - Stock Type: Cat
  - Rating: 2
  - Sector: Technology
  - Quantity: 8
  - Purchase Price: 416.04
  -> UPDATING existing stock
Processing AMZN:
  - Company: AMAZON.COM INC
  - Stock Type: Comp
  - Rating: 1
  - Sector: Technology
  - Quantity: 20
  - Purchase Price: 175.96
  -> UPDATING existing stock
Processing WM:
  - Company: WASTE MANAGEMENT INC
  - Stock Type: Comp
  - Rating: 1
  - Sector: Industrials
  - Quantity: 20
  - Purchase Price: 98.37
  -> UPDATING existing stock
Processing GS:
  - Company: GOLDMAN SACHS GROUP INC
  - Stock Type: Cycl
  - Rating: 2
  - Sector: Financial Services
  - Quantity: 8
  - Purchase Price: 544.3
  -> UPDATING existing stock
Processing JPM:
  - Company: JPMORGAN CHASE & CO
  - Stock Type: Cycl
  - Rating: 2
  - Sector: Financial Services
  - Quantity: 18
  - Purchase Price: 130.52
  -> UPDATING existing stock
=== REBALANCE COMPLETE ===
Successfully processed 20 stocks
MA: purchase_price=undefined
COST: purchase_price=undefined
PEP: purchase_price=undefined
CAT: purchase_price=undefined
PWR: purchase_price=undefined
CW: purchase_price=undefined
PANW: purchase_price=undefined
AVGO: purchase_price=undefined
UBER: purchase_price=undefined
MCO: purchase_price=undefined
BIL: purchase_price=undefined
GLD: purchase_price=undefined
MSFT: purchase_price=undefined
AAPL: purchase_price=undefined
GOOG: purchase_price=undefined
META: purchase_price=undefined
AMZN: purchase_price=undefined
WM: purchase_price=undefined
GS: purchase_price=undefined
JPM: purchase_price=undefined
Getting current prices for 20 symbols in USD region
GS current price: 598.54, daily change: 0.0518191%
MA current price: 563.58, daily change: -1.15059%
MCO current price: 469.65, daily change: -0.447265%
CAT current price: 343.39, daily change: -0.521448%
JPM current price: 260.71, daily change: 0.0153366%
PANW current price: 186.736, daily change: 0.32018536%
PWR current price: 335.36, daily change: 1.36928%
GLD current price: 309.75, daily change: 2.19063%
AVGO current price: 228.72, daily change: -0.7851462%
CW current price: 428.45, daily change: 3.01013%
WM current price: 236.81, daily change: 1.4958%
UBER current price: 87.75, daily change: -0.284091%
AMZN current price: 200.99, daily change: -1.0388974%
META current price: 627.06, daily change: -1.4939456%
GOOG current price: 169.59, daily change: -1.3896961%
MSFT current price: 450.18, daily change: -1.0288864%
COST current price: 1008.5, daily change: -0.94585216%
BIL current price: 91.69, daily change: 0.0436453%
PEP current price: 129.34, daily change: -0.5994457%
AAPL current price: 195.27, daily change: -3.0244322%
Found current prices for 20/20 symbols in USD region
Debug MA: DB purchasePrice=88.70, converted=88.7
Debug COST: DB purchasePrice=543.30, converted=543.3
Debug PEP: DB purchasePrice=154.53, converted=154.53
Debug CAT: DB purchasePrice=348.46, converted=348.46
Debug PWR: DB purchasePrice=271.35, converted=271.35
Debug CW: DB purchasePrice=355.03, converted=355.03
Debug PANW: DB purchasePrice=149.18, converted=149.18
Debug AVGO: DB purchasePrice=146.49, converted=146.49
Debug UBER: DB purchasePrice=36.58, converted=36.58
Debug MCO: DB purchasePrice=238.21, converted=238.21
Debug BIL: DB purchasePrice=91.67, converted=91.67
Debug GLD: DB purchasePrice=147.49, converted=147.49
Debug MSFT: DB purchasePrice=305.11, converted=305.11
Debug AAPL: DB purchasePrice=24.80, converted=24.8
Debug GOOG: DB purchasePrice=29.06, converted=29.06
Debug META: DB purchasePrice=416.04, converted=416.04
Debug AMZN: DB purchasePrice=175.96, converted=175.96
Debug WM: DB purchasePrice=98.37, converted=98.37
Debug GS: DB purchasePrice=544.30, converted=544.3
Debug JPM: DB purchasePrice=130.52, converted=130.52
3:38:12 PM [express] POST /api/portfolios/USD/rebalance 200 in 960ms :: {"message":"Successfully rebâ€¦
Fetching portfolio stocks for USD with refreshed metrics...
Getting portfolio stocks for USD (using portfolio tables)
DEBUG: Raw DB data for UBER: purchasePrice=36.58
Getting current prices for 20 symbols in USD region
GS current price: 598.54, daily change: 0.0518191%
MA current price: 563.58, daily change: -1.15059%
MCO current price: 469.65, daily change: -0.447265%
CAT current price: 343.39, daily change: -0.521448%
JPM current price: 260.71, daily change: 0.0153366%
PANW current price: 186.736, daily change: 0.32018536%
PWR current price: 335.36, daily change: 1.36928%
GLD current price: 309.75, daily change: 2.19063%
AVGO current price: 228.72, daily change: -0.7851462%
CW current price: 428.45, daily change: 3.01013%
WM current price: 236.81, daily change: 1.4958%
UBER current price: 87.75, daily change: -0.284091%
AMZN current price: 200.99, daily change: -1.0388974%
META current price: 627.06, daily change: -1.4939456%
GOOG current price: 169.59, daily change: -1.3896961%
MSFT current price: 450.18, daily change: -1.0288864%
COST current price: 1008.5, daily change: -0.94585216%
BIL current price: 91.69, daily change: 0.0436453%
PEP current price: 129.34, daily change: -0.5994457%
AAPL current price: 195.27, daily change: -3.0244322%
Found current prices for 20/20 symbols in USD region
Debug UBER: DB purchasePrice=36.58, converted=36.58
Debug MCO: DB purchasePrice=238.21, converted=238.21
Debug BIL: DB purchasePrice=91.67, converted=91.67
Debug GLD: DB purchasePrice=147.49, converted=147.49
Debug MSFT: DB purchasePrice=305.11, converted=305.11
Debug AAPL: DB purchasePrice=24.80, converted=24.8
Debug GOOG: DB purchasePrice=29.06, converted=29.06
Debug META: DB purchasePrice=416.04, converted=416.04
Debug AMZN: DB purchasePrice=175.96, converted=175.96
Debug WM: DB purchasePrice=98.37, converted=98.37
Debug GS: DB purchasePrice=544.30, converted=544.3
Debug JPM: DB purchasePrice=130.52, converted=130.52
Debug MA: DB purchasePrice=88.70, converted=88.7
Debug COST: DB purchasePrice=543.30, converted=543.3
Debug PEP: DB purchasePrice=154.53, converted=154.53
Debug CAT: DB purchasePrice=348.46, converted=348.46
Debug PWR: DB purchasePrice=271.35, converted=271.35
Debug CW: DB purchasePrice=355.03, converted=355.03
Debug PANW: DB purchasePrice=149.18, converted=149.18
Debug AVGO: DB purchasePrice=146.49, converted=146.49
FIXED: UBER purchasePrice=36.58
Successfully fetched 20 portfolio stocks for USD with up-to-date metrics
3:38:12 PM [express] GET /api/portfolios/USD/stocks 200 in 39ms :: [{"id":47,"symbol":"UBER","companâ€¦
Performance history request: {
  region: 'USD',
  timeRange: undefined,
  startDate: '2024-05-26',
  endDate: undefined
}
Getting performance history for USD from 2024-05-26 to now
SQL: SELECT * FROM portfolio_performance_usd WHERE date >= $1 ORDER BY date ASC [ '2024-05-26' ]
3:38:24 PM [express] GET /api/performance-history 304 in 125ms :: {"status":"success","data":[{"dateâ€¦
3:38:25 PM [express] GET /api/current-prices/USD 304 in 23ms :: [{"id":31,"symbol":"GS","region":"USâ€¦
3:38:25 PM [express] GET /api/market-indices/real-time 304 in 155ms :: {"sp500":{"return":-0.68,"posâ€¦
3:38:55 PM [express] GET /api/current-prices/USD 304 in 130ms :: [{"id":31,"symbol":"GS","region":"Uâ€¦
3:38:56 PM [express] GET /api/market-indices/real-time 304 in 168ms :: {"sp500":{"return":-0.68,"posâ€¦